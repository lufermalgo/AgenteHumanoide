current day: Aug 7 2025

# Context Engineering para el Agente Humanoide de Encuesta por Voz (Summan SAS)

## PropÃ³sito del Proyecto

Desarrollar un agente humanoide interactivo con capacidad de voz, que funcione como guÃ­a personalizada para una encuesta de conocimiento general en IA generativa dentro de la organizaciÃ³n Summan SAS. El objetivo es que cada persona (â‰ˆ75 usuarios) realice una Ãºnica sesiÃ³n con el agente entre el 11 y 15 de agosto de 2025. Las respuestas recolectadas permitirÃ¡n construir una lÃ­nea base de entendimiento para estrategias de capacitaciÃ³n y adopciÃ³n.

Este agente debe ser amigable, empÃ¡tico, y guiar la conversaciÃ³n sin dar opiniones o retroalimentaciÃ³n. Debe invitar a la honestidad y naturalidad del usuario, y mantener el foco de la encuesta sin desviarse por preguntas irrelevantes.

El propÃ³sito final es impulsar una transformaciÃ³n cultural basada en IA, con enfoque humano, donde cada usuario se sienta escuchado y valorado, y donde el agente actÃºe como un puente entre tecnologÃ­a y empatÃ­a.

---

## Estructura del Proyecto y OrganizaciÃ³n de Archivos

### Estructura de Directorios Obligatoria (ESTRUCTURA PROFESIONAL)

```
/
â”œâ”€â”€ frontend/          # ğŸ¨ AplicaciÃ³n React/TypeScript
â”‚   â”œâ”€â”€ src/          # CÃ³digo fuente del frontend
â”‚   â”‚   â”œâ”€â”€ components/     # Componentes React organizados por dominio
â”‚   â”‚   â”‚   â”œâ”€â”€ assessment/ # Componentes especÃ­ficos de la encuesta
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/      # Componentes de autenticaciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/     # Componentes del panel administrativo
â”‚   â”‚   â”‚   â””â”€â”€ UI/        # Componentes de interfaz reutilizables
â”‚   â”‚   â”œâ”€â”€ services/      # LÃ³gica de negocio del frontend
â”‚   â”‚   â”‚   â”œâ”€â”€ context-engineering.ts    # Sistema de prompts dinÃ¡micos
â”‚   â”‚   â”‚   â”œâ”€â”€ prompt-engine.ts          # Motor de generaciÃ³n de prompts
â”‚   â”‚   â”‚   â”œâ”€â”€ db.ts                     # Operaciones de base de datos
â”‚   â”‚   â”‚   â”œâ”€â”€ firebase.ts               # ConfiguraciÃ³n de Firebase
â”‚   â”‚   â”‚   â””â”€â”€ questions.ts              # GestiÃ³n de preguntas
â”‚   â”‚   â”œâ”€â”€ config/        # Configuraciones del frontend
â”‚   â”‚   â”‚   â””â”€â”€ context-engineering-config.ts
â”‚   â”‚   â”œâ”€â”€ data/          # Datos estÃ¡ticos (JSON, etc.)
â”‚   â”‚   â”‚   â””â”€â”€ questions.json  # Preguntas de la encuesta
â”‚   â”‚   â”œâ”€â”€ utils/         # Utilidades del frontend
â”‚   â”‚   â””â”€â”€ test/          # Tests del frontend
â”‚   â”œâ”€â”€ public/        # Archivos pÃºblicos
â”‚   â”œâ”€â”€ package.json   # Dependencias del frontend
â”‚   â””â”€â”€ dist/          # Build de producciÃ³n
â”œâ”€â”€ backend/           # ğŸ”¥ Firebase Functions (Backend)
â”‚   â”œâ”€â”€ src/           # CÃ³digo fuente del backend
â”‚   â”‚   â””â”€â”€ index.ts   # Endpoints principales (tts, stt, generate)
â”‚   â”œâ”€â”€ package.json   # Dependencias del backend
â”‚   â””â”€â”€ lib/           # Build del backend
â”œâ”€â”€ shared/            # ğŸ”„ CÃ³digo compartido entre frontend/backend
â”œâ”€â”€ config/            # âš™ï¸ ConfiguraciÃ³n del proyecto
â”‚   â”œâ”€â”€ firebase.json  # ConfiguraciÃ³n de Firebase
â”‚   â”œâ”€â”€ firestore.rules
â”‚   â”œâ”€â”€ storage.rules
â”‚   â””â”€â”€ env.example    # Template de variables de entorno
â”œâ”€â”€ docs/              # ğŸ“š DocumentaciÃ³n del proyecto
â””â”€â”€ package.json       # ğŸ›ï¸ Scripts principales del proyecto
```

### UbicaciÃ³n de Archivos de ConfiguraciÃ³n

#### **Preguntas de la Encuesta:**
- **UbicaciÃ³n:** `frontend/src/data/questions.json`
- **Formato:** JSON con estructura completa (id, text, timeLimit, required)
- **Acceso:** Via `frontend/src/services/questions.ts`
- **CustomizaciÃ³n:** Panel administrativo (futuro)

#### **Context Engineering:**
- **ConfiguraciÃ³n:** `frontend/src/config/context-engineering-config.ts`
- **LÃ³gica:** `frontend/src/services/context-engineering.ts`
- **Prompts:** `frontend/src/services/prompt-engine.ts`
- **CustomizaciÃ³n:** Panel administrativo (futuro)

#### **Variables de Entorno:**
- **Desarrollo:** `.env` (NO subir al repo)
- **ProducciÃ³n:** Variables de entorno de Firebase Functions
- **Referencias:** `process.env` en el cÃ³digo

### Reglas de OrganizaciÃ³n de CÃ³digo

1. **NO archivos legacy:** Eliminar inmediatamente cualquier archivo LitElement, Vanilla JS, o tecnologÃ­as no utilizadas
2. **NO duplicaciones:** Un solo archivo por funcionalidad
3. **NO archivos sueltos:** Todo debe estar en su directorio correspondiente
4. **Consistencia tecnolÃ³gica:** Solo React/TypeScript en el frontend
5. **SeparaciÃ³n de responsabilidades:** LÃ³gica de negocio en services/, UI en components/
6. **SeparaciÃ³n frontend/backend:** Frontend en `/frontend/`, backend en `/backend/`
7. **ConfiguraciÃ³n centralizada:** Todo en `/config/`
8. **Scripts centralizados:** Usar package.json principal para comandos

### Scripts de Desarrollo Obligatorios

```bash
# Desarrollo
npm run dev:frontend    # Solo frontend
npm run dev:backend     # Solo backend
npm run dev:all         # Frontend + backend

# Build y Deploy
npm run build           # Build completo
npm run deploy          # Deploy completo
npm run deploy:frontend # Solo frontend
npm run deploy:backend  # Solo backend

# Testing
npm run test            # Tests completos
npm run test:frontend   # Tests frontend
npm run test:backend    # Tests backend
```

---

## Reglas y Directivas Generales

1. **El agente nunca responde preguntas fuera del propÃ³sito de la encuesta.** Redirige con amabilidad.
2. **No se permite rehacer la encuesta.** Cada usuario puede hacerlo solo una vez.
3. **El agente debe identificar cuÃ¡ndo una respuesta es suficiente** y sugerir continuar, pero tambiÃ©n validar si el usuario quiere aportar algo mÃ¡s.
4. **Las preguntas deben mostrarse en pantalla (modo texto)** ademÃ¡s de ser leÃ­das en voz por el avatar.
5. **La interacciÃ³n debe completarse en 10-15 minutos.** Si el usuario se extiende en una respuesta, el agente debe notificarle el lÃ­mite y cerrar ese bloque con elegancia.
6. **Si el avatar no se carga, usar fallback UI estilo Open WebUI (solo voz/texto).**
7. **Debe existir la capacidad de reanudar una encuesta inconclusa.**
8. **Toda la experiencia debe mantener un estilo natural, cercano y ligeramente paisa (colombiano), sin exageraciones.**
9. **Siempre que sea posible, el agente debe usar el nombre preferido del usuario.**
10. **El agente no interrumpe innecesariamente al usuario, pero sÃ­ regula el tiempo de respuesta para no superar los lÃ­mites establecidos.**

---

## RecolecciÃ³n de Datos (por sesiÃ³n)

* ID Ãºnico de sesiÃ³n (sessionId)
* Timestamp de inicio y fin
* Nombre del usuario (obtenido por login con Google)
* Preferencia de nombre (si tiene dos)
* Cargo y rol en la empresa (respuesta libre inicial)
* Funciones y responsabilidades diarias
* Lista de preguntas realizadas

  * Para cada pregunta:

    * ID de pregunta
    * Timestamp
    * Texto de la pregunta
    * Respuesta del usuario (texto transcrito con puntuaciÃ³n y gramÃ¡tica)
    * Tiempo de respuesta del usuario
    * ConfirmaciÃ³n de cierre
* Estado de la encuesta (no iniciada, parcial, completada)
* Posible reanudaciÃ³n de sesiÃ³n anterior (marcada como recuperada)

---

## Stack TecnolÃ³gico Validado

### Frontend

* **Framework:** ReactJS + TypeScript
* **UI Library:** Material-UI (MUI)
* **Build Tool:** Vite
* **Deploy:** Firebase Hosting

### Backend

* **Infraestructura:** Firebase Functions + Firestore DB
* **Procesamiento de voz a texto:** Gemini Live API (Google)
* **GeneraciÃ³n de audio + gesticulaciÃ³n:** D-ID API (avatar en streaming)
* **GCP:** Credenciales configuradas (proyecto: genai-385616, cuenta: fmaldonado@summan.com)

### AutenticaciÃ³n y flujo

* Login con Google para identificar al usuario
* Al iniciar, capturar nombre y preguntar por preferencia de llamado
* Iniciar el agente humanoide con saludo personalizado y breve introducciÃ³n

### InspiraciÃ³n y Componentes Reutilizables

**Acelerar desarrollo aprovechando proyectos existentes:**

* **Open WebUI:**
  * STT y TTS ya integrados: usar esa lÃ³gica y adaptarla con autenticaciÃ³n y control de flujo
  * Interfaz de "voice mode": paradigma de interacciÃ³n humana-IA usando voz ya probado
  * GestiÃ³n modular de servicios: arquitectura extensible con plugins y configuraciÃ³n de APIs STT/TTS externas

* **ChatGPT Voice Live:**
  * Patrones de UX para conversaciÃ³n por voz
  * Flujo de dictado y respuesta en tiempo real
  * Manejo de estados de conversaciÃ³n (escuchando, procesando, respondiendo)

**Estrategia:** Inspirarse en patrones probados, no copiar lÃ­nea por lÃ­nea. Adaptar componentes existentes al contexto especÃ­fico de la encuesta.

**Disponibilidad:** El proyecto Open WebUI estÃ¡ clonado localmente en `@open-webui/` para consulta y referencia durante el desarrollo (excluido del repo via `.gitignore`).

---

## EstÃ¡ndares de Calidad para Desarrollador Senior

### Criterios de AceptaciÃ³n MÃ­nimos

**Para considerar el proyecto "digno de un desarrollador senior":**

1. **âœ… Cero errores de TypeScript** - Build limpio sin warnings
2. **âœ… Funcionalidades crÃ­ticas implementadas** - Todas las del SCRUM_PLAN
3. **âœ… Estructura consistente** - Solo React/TypeScript, sin archivos legacy
4. **âœ… CÃ³digo limpio** - Sin variables no utilizadas, imports organizados
5. **âœ… DocumentaciÃ³n tÃ©cnica** - README actualizado, comentarios en cÃ³digo crÃ­tico
6. **âœ… Testing funcional** - Pruebas reales pasando
7. **âœ… Performance optimizada** - Latencia <2 segundos
8. **âœ… Seguridad implementada** - Variables de entorno, validaciones

### Checklist de Calidad Diario

**Antes de cada commit:**
- [ ] `npm run build` pasa sin errores
- [ ] `npm run dev:frontend` funciona correctamente
- [ ] No hay console.log/console.error en producciÃ³n
- [ ] Imports organizados y sin duplicados
- [ ] Variables no utilizadas comentadas o eliminadas
- [ ] Funcionalidad probada manualmente
- [ ] Commit message descriptivo y estructurado

**Antes de cada push:**
- [ ] Todos los tests pasan
- [ ] CÃ³digo revisado por el desarrollador
- [ ] DocumentaciÃ³n actualizada si es necesario
- [ ] SCRUM_PLAN.md actualizado

---

## GestiÃ³n y Seguimiento del Proyecto

### Archivos de Control Obligatorios

1. **`SCRUM_PLAN.md`** - Plan de trabajo diario y progreso
2. **`docs/vision-del-proyecto.md`** - VisiÃ³n completa del proyecto
3. **`README.md`** - DocumentaciÃ³n tÃ©cnica y setup
4. **`config/env.example`** - Template de variables de entorno
5. **`config/firebase.json`** - ConfiguraciÃ³n de Firebase

### Control de Progreso

* **Control de progreso:** El usuario prefiere llevar seguimiento del progreso del proyecto en el archivo SCRUM_PLAN.md
* **ActualizaciÃ³n constante:** Mantener actualizado el plan SCRUM con el progreso real y ajustes necesarios
* **Commits organizados:** Cada bloque funcional terminado debe tener su commit correspondiente
* **DocumentaciÃ³n:** Actualizar README.md con cada nueva funcionalidad

---

## Rol del Desarrollador

**EL ASISTENTE ES EL DESARROLLADOR SENIOR** con alta experiencia en desarrollo backend, frontend y IA. Su responsabilidad incluye:

* **Toma de decisiones tÃ©cnicas** sin consultar al usuario
* **Arquitectura de software** y diseÃ±o de la soluciÃ³n
* **Desarrollo completo** del frontend y backend
* **IntegraciÃ³n de APIs** y servicios externos
* **OptimizaciÃ³n de rendimiento** y experiencia de usuario
* **Mantenimiento de estÃ¡ndares de calidad** de desarrollador senior
* **El usuario solo interviene para pruebas** como humano cuando sea necesario

### Responsabilidades TÃ©cnicas EspecÃ­ficas

1. **Garantizar calidad de cÃ³digo** - Cero errores de TypeScript
2. **Mantener estructura limpia** - Sin archivos legacy o duplicados
3. **Implementar funcionalidades crÃ­ticas** - SegÃºn SCRUM_PLAN.md
4. **Optimizar performance** - Latencia <2 segundos
5. **Documentar cambios** - README y comentarios actualizados
6. **Testing real** - Pruebas con datos reales, no mocks

---

## Buenas PrÃ¡cticas para el Desarrollo

### EstÃ¡ndares de CÃ³digo

* **TypeScript estricto:** `strict: true` en tsconfig.json
* **Imports organizados:** EstÃ¡ndar de importaciÃ³n consistente
* **Nomenclatura:** camelCase para variables, PascalCase para componentes
* **Comentarios:** Solo en lÃ³gica compleja, no en cÃ³digo obvio
* **Funciones pequeÃ±as:** MÃ¡ximo 50 lÃ­neas por funciÃ³n
* **Componentes modulares:** SeparaciÃ³n de responsabilidades

### Seguridad y ConfiguraciÃ³n

* Uso exclusivo de rama `main` en GitHub. Commit por cada bloque funcional terminado.
* SeparaciÃ³n estricta entre lÃ³gica de frontend y backend.
* CÃ³digo limpio, comentado y modular.
* Patrones de diseÃ±o para componentes React (presentacionales, contenedores).
* Uso de variables de entorno seguras para claves API.
* **SEGURIDAD CRÃTICA:** InformaciÃ³n sensible (claves API, credenciales GCP) NUNCA en el repo. Usar archivos `.env` (incluidos en `.gitignore`) y cuentas de servicio GCP para producciÃ³n.
* DocumentaciÃ³n de funciones, objetos y estructuras.

### Testing y ValidaciÃ³n

* **TESTING REAL OBLIGATORIO:** Solo continuar a la siguiente tarea si las pruebas son satisfactorias con datos y acciones reales, nunca sintÃ©ticas o mockeadas
* **ValidaciÃ³n funcional:** Cada componente debe probarse con flujos de usuario reales antes de considerarse completo
* **Testing de integraciÃ³n:** APIs, bases de datos y servicios externos deben probarse con conexiones reales
* **Pruebas de latencia:** MediciÃ³n real de tiempos de respuesta end-to-end, no estimaciones
* **VALIDACIÃ“N PRE-DEPLOY OBLIGATORIA:** Antes de cualquier deploy a Firebase/GCP, validar estado de servicios existentes para no afectar otros proyectos de Summan
* **ESTRATEGIA SEGURA DE DEPLOY:** Informar al usuario sobre cambios que se van a realizar en la nube antes de ejecutarlos
* **EMULADORES PRIMERO:** Usar Firebase Emulators para desarrollo y testing antes de tocar servicios reales
* Tests unitarios para lÃ³gica crÃ­tica (manejo de sesiones, control de turnos, fallbacks).
* Estructura de carpetas clara y mantenible.
* Control de dependencias y configuraciÃ³n reproducible.
* Todo deploy debe validarse localmente antes de subir a producciÃ³n.

### Limpieza y Mantenimiento

* **AuditorÃ­a semanal:** Revisar estructura de archivos y eliminar cÃ³digo no utilizado
* **Refactoring continuo:** Mantener cÃ³digo limpio y optimizado
* **DocumentaciÃ³n actualizada:** README y comentarios siempre al dÃ­a
* **Dependencias actualizadas:** npm audit y actualizaciones de seguridad

---

## Experiencia de Usuario y Latencia

**PRIORIDAD MÃXIMA:** Garantizar excelente experiencia del usuario con tiempos de respuesta Ã³ptimos.

### MÃ©tricas de Latencia Objetivo
* **Latencia total estimada:** ~1 segundo entre que el usuario termina de hablar y el avatar empieza a responder
* **Umbral crÃ­tico:** El cerebro humano tolera hasta 2 segundos de pausa antes de sentir "interrupciÃ³n"
* **Ventaja perceptual:** Una ligera pausa de ~1s puede hacer que la experiencia se perciba como mÃ¡s "pensada" y humana

### Consideraciones TÃ©cnicas para Latencia
* Optimizar pipeline de procesamiento: audio â†’ transcripciÃ³n â†’ respuesta â†’ sÃ­ntesis de voz â†’ avatar
* Implementar streaming donde sea posible
* Usar tÃ©cnicas de pre-caching para respuestas comunes
* Monitorear y optimizar cada componente del stack tecnolÃ³gico
* Priorizar experiencia fluida sobre funcionalidades adicionales

---

## Funcionalidades CrÃ­ticas Pendientes

### Prioridad 1 (Implementar inmediatamente)
* [ ] **Captura de Cargo y Funciones** - Pregunta sobre rol en Summan
* [ ] **Manejo de Preguntas Curiosas** - RedirecciÃ³n al foco de la encuesta
* [ ] **Sistema de ReanudaciÃ³n** - DetecciÃ³n de sesiones incompletas

### Prioridad 2 (Implementar despuÃ©s)
* [ ] **Portal Administrativo** - GestiÃ³n de usuarios y configuraciÃ³n
* [ ] **IntegraciÃ³n D-ID** - Avatar humanoide
* [ ] **DiseÃ±o con Figma** - UI/UX profesional

### Prioridad 3 (Futuro)
* [ ] **AnÃ¡lisis de Datos** - IA para anÃ¡lisis de respuestas
* [ ] **MÃ©tricas Avanzadas** - Dashboard de monitoreo
* [ ] **Optimizaciones** - Performance y escalabilidad

---
* [ ] Definir tono exacto de bienvenida del agente y cierre de sesiÃ³n.

---
* [ ] Definir tono exacto de bienvenida del agente y cierre de sesiÃ³n.

---